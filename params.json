{"name":"Diffscuss","tagline":"Code reviews.  In plain text.","body":"# Diffscuss: Code Reviews.  In Plain Text.\r\n\r\n## What is Diffscuss?\r\n\r\nDiffscuss is:\r\n\r\n* a file format, built on the the unified diff format, that allows\r\n  threaded code reviews to exist inline with the diffs they address\r\n\r\n* an Emacs mode and Vim plugin to support responding to / managing\r\n  code reviews in that format (including jumping directly to the\r\n  source code a comment addresses)\r\n\r\n* a set of command line tools to support generating and managing\r\n  reviews in the diffscuss format with a simple, directory based tool\r\n  for posting and managing code reviews\r\n\r\nWe at Hut 8 Labs originally developed diffscuss to help us do code\r\nreviews when we were onsite with a client who didn't have their own\r\ncode review system.  We found ourselves emailing diffs back and forth,\r\nwriting things like \"about halfway through the diff you do X, maybe\r\nyou should do Y?\"  Eventually we started writing comments right in the\r\ndiffs themselves, with markers like \"EWJ REVIEW!!!\" and thought \"There\r\nhas to be a better way.\"\r\n\r\nNow, about 6 months into using diffscuss, we've grown to love its\r\nsupport for code reviews in our editors--where we're already efficient\r\nat reading and navigating code--and especially its abililty to jump\r\ndirectly from a comment to the corresponding line of actual source,\r\nwhich lowers the activation energy for addressing reviews and actually\r\nmaking all those little suggested improvements.\r\n\r\n## What Does a Diffscuss Review Look Like?\r\n\r\nScreenshot of a Diffscuss review in Emacs:\r\n\r\n![Emacs Screenshot](https://github.com/hut8labs/diffscuss/blob/master/doc/diffscuss-reading-review.png?raw=true)\r\n\r\nAfter jumping to source:\r\n\r\n![Emacs Screenshot](https://github.com/hut8labs/diffscuss/blob/master/doc/diffscuss-jump-to-source.png?raw=true)\r\n\r\n## Why Might You Want to Use Diffscuss?\r\n\r\n* you like the idea of reading and responding to code reviews right in\r\n  your editor\r\n\r\n* you want to lower the activation energy needed to apply small fixes\r\n  and suggestions (jump right to the source with a single key combo!\r\n  make the change!  jump right back!)\r\n\r\n* you like the idea of keeping your reviews in your repo, right next\r\n  to your code, or emailing them back and forth if you're just a\r\n  couple hackers working on something and that's easier\r\n\r\n* you like the idea of using grep and all the rest of that unix-y\r\n  toolchain goodness on your reviews\r\n\r\n## Why Shouldn't You Use Diffscuss?\r\n\r\n* you're a big team, or you have significant process around code\r\n  reviews (e.g. you have automated restrictions for review-then-commit\r\n  workflows)\r\n\r\n* you're not using git (for the moment, diffscuss is tightly\r\n  integrated with git)\r\n\r\n* you're not using Emacs or Vim (for the moment, those are the two\r\n  editors with diffscuss tooling support)\r\n\r\n## Getting Started\r\n\r\n### Install the diffscuss exe\r\n\r\nDiffscuss is a set of python utils wrapped in a single exe.  You can\r\neither get the latest source from github and run run ```setup.py\r\ninstall```, or you can grab the latest release from pypi with\r\n```easy_install diffscuss``` or ```pip install diffscuss```.\r\n\r\n### Install the Emacs mode or Vim plugin\r\n\r\n(see \"The Emacs Mode\" and \"The Vim Plugin\" below for installation and\r\nusage)\r\n\r\nYou can now go bare bolts and just open up any unified diff file to\r\nstart reviewing, or you can...\r\n\r\n### Generate a diffscuss review.\r\n\r\nUse ```diffscuss generate``` from within a git repo to generate a new\r\nreview.  The only required argument is the revision range to construct\r\nthe review from, which is passed through as is to git and can\r\ntherefore be in any format recognized by git log\r\n(e.g. ```HEAD^..HEAD``` is a common one).\r\n\r\nBy default all the commit messages within the range will be collected\r\ninto the initial review comment, and the author will be the value of\r\nthe ```user.name``` git config setting.\r\n\r\n### Set up simple code review management\r\n\r\nDiffscuss supports an extremely basic per-user \"inbox\" for incoming\r\ncode reviews.\r\n\r\nThese inbox are just directories, and reviews are \"added to\" an inbox\r\nby creating a symbolic link to a diffscuss file (which is kept in a\r\nper-repo \"diffscussions\" directory).\r\n\r\nTo get started, run ```diffscuss mailbox init``` (or run with -h to\r\nsee help).  This will create (by default) a .diffscuss-mb file and a\r\n\"diffscussions\" directory at the top level of your repo, both of which\r\nshould be added to source control.\r\n\r\nNext you'll want to create an inbox per user, with ```diffscuss\r\nmailbox make-inbox <user-name>```, which will create an inbox under\r\n\"diffscussions/users/<user-name>\".\r\n\r\nFinally, so that you can check your inbox for new reviews, you'll want\r\nto tell diffscuss which inbox should be considered yours by running\r\n```diffscuss mailbox set-default-inbox <your-user-name>```.  This\r\ncreates a config variable called diffscuss-mb.inbox in your local git\r\nconfig and sets it to the user name you supplied.\r\n\r\n### Use simple code review management\r\n\r\nUnder ```diffscuss mailbox``` There is support for posting reviews,\r\nmarking them done (which just translates to removing symlinks in user\r\ndirectories), and \"bouncing\" reviews, which means marking your review\r\ndone and asking someone else to take a look (e.g., because you made\r\ncomments that you want the original poster to implement / respond to).\r\n\r\nUse ```diffscuss mailbox -h``` and ```diffscuss mailbox <subcommand>\r\n-h``` for arguments and options to run from the command line.\r\n\r\nThe Emacs and Vim modes also have support for checking your mailbox,\r\nposting, bouncing, and marking reviews done right from your editor.\r\n\r\nIn Emacs:\r\n\r\n* ```C-c m p``` prompts for recipients and posts the current Diffscuss\r\n  file for their review\r\n\r\n* ```C-c m b``` prompts for recipients and bounces the review to them,\r\n  removing the review from your inbox.\r\n\r\n* ```C-c m d``` marks the review as done, removing it from your inbox.\r\n\r\n* ```M-x diffscuss-mb-check``` checks your inbox and lists all\r\n  incoming reviews.  You may wish to bind it globally to ```C-c m c```\r\n  with:\r\n\r\n```\r\n(global-set-key \"\\C-cmc\"  'diffscuss-mb-check)\r\n```\r\n\r\nIn Vim:\r\n\r\n* ```<leader>mp``` prompts for recipients and posts the current Diffscuss\r\n  file for their review\r\n\r\n* ```<leader>mb``` prompts for recipients and bounces the review to them,\r\n  removing the review from your inbox.\r\n\r\n* ```<leader>md``` marks the review as done, removing it from your inbox.\r\n\r\n* ```<leader>mc``` opens a preview window with a list of all incoming\r\n  reviews in your inbox. You can use ```gf``` with your cursor on a\r\n  filename in the list to open the review (or e.g. ```C-w gf``` to open it\r\n  in a new tab).\r\n\r\n## Getting help\r\n\r\nThe diffscuss exe has help available with -h globally and for each\r\nsubcommand.\r\n\r\n## The Format in a Nutshell\r\n\r\nDiffscuss adds a single beginning-of-line character to the unified\r\ndiff format: %, which marks the beginning of a comment line.  Lines\r\nbeginning with %* are comment headers, and lines beginning with %- are\r\ncomment bodies.  The number of * or - characters indicates reply\r\nthreading.\r\n\r\nComments apply to the line directly above them.  Comments at the top\r\nof the file apply to the entire review in general.\r\n\r\nTake a look at the \"Format Definition\" section for (much) more detail.\r\n\r\n## The Emacs Mode\r\n\r\nThe Emacs mode is implemented in a single .el file, diffscuss-mode.el.\r\nTo install, either move the diffscuss-mode.el file to a directory in\r\nyour load path or else add the Diffscuss mode directory to your load\r\npath in your .emacs file like so:\r\n\r\n```\r\n(setq load-path\r\n      (append (list nil \"/path/to/diffscuss/diffscuss-mode\")\r\n               load-path))\r\n```\r\n\r\nOnce the file is in your load path, require the mode with:\r\n\r\n```\r\n(require 'diffscuss-mode)\r\n```\r\n\r\nThe mode colorizes Diffscuss files to make for easier reading.  In\r\naddition it helps with:\r\n\r\n### Inserting Comments\r\n\r\nThe main command you need to know is ```C-c C-c```, which generally\r\n\"does the right thing\" based on the position of the cursor.  To wit:\r\n\r\n* If the cursor is at the very top of the buffer, it will insert a new\r\n  review-level comment (this function is available anywhere in the\r\n  buffer with ```C-c C-f```).\r\n\r\n* If the cursor is inside another comment, it will create a reply to\r\n  that comment (this can also be invoked with ```C-c C-r```).\r\n\r\n* If the cursor is inside the diff index information for a file /\r\n  hunk, it will insert a comment after the \"range line\" (the line\r\n  beginning with @@).\r\n\r\n* If the cursor is on a diff line, it will create a comment directly\r\n  below that line (this is also available with ```C-c C-i```).\r\n\r\n### Jumping to Source\r\n\r\nThis currently requires that the Diffscuss file you are visiting is\r\nsomewhere under a git checkout of the repo against which the Diffscuss\r\nfile was generated.\r\n\r\n#### Local Source\r\n\r\nIf you position the cursor on one of the diff lines in a Diffscuss\r\nfile, then:\r\n\r\n* ```C-c s``` will attempt to find the local source file / line in\r\n  that file that's the best candidate to match up with the Diffscuss\r\n  line the cursor is currently on.\r\n\r\n#### Repository Versions of the Source\r\n\r\n* ```C-c -``` will open up a temporary buffer containing the old\r\n  version of the source (if it's available locally), with the cursor\r\n  positioned on the same line.\r\n\r\n* ```C-c +``` will open up a temporary buffer containing the new\r\n  version of the source (if it's available locally), with the cursor\r\n  positioned on the same line.\r\n\r\n### Navigation\r\n\r\nYou can move around the Diffscussion quickly using:\r\n\r\n* ```C-c f``` to move forward one comment.\r\n\r\n* ```C-c b``` to move back one comment.\r\n\r\n* ```C-c n``` to move to the next thread.\r\n\r\n* ```C-c p``` to move to the previous thread.\r\n\r\n* ```C-c a``` to move to the beginning of the current thread.\r\n\r\n* ```C-c e``` to move to the end of the current thread.\r\n\r\n## The Vim Plugin\r\n\r\nLike the Emacs mode, the Vim plugin offers syntax highlighting, comment insertion,\r\ncommands for jumping to source files, and motions for comments and threads.\r\nThe Vim plugin is implemented primarily in Python, so you'll need a version of\r\nVim compiled with Python support in order to use it\r\n(```vim --version | grep '+python'```).\r\n\r\n### Installation\r\n\r\n#### With Vundle\r\n\r\nIf you use Vundle, add this to your `.vimrc` and then `:BundleInstall`:\r\n\r\n```\r\nBundle 'hut8labs/diffscuss', {'rtp': 'diffscuss.vim/'}\r\n```\r\n\r\n#### With Pathogen\r\n\r\nIf you use Pathogen:\r\n\r\n1. Clone the `diffscuss` repository.\r\n2. Copy `diffscuss/diffscuss.vim` to `~/.vim/bundle`.\r\n3. Set the `diffscuss_dir` key of `g:diffscuss_config` to the path of the\r\n   `diffscuss` clone.\r\n\r\n### Configuration\r\n\r\nThe Vim plugin will use its environment and `git config` to determine your name\r\nand email (for pre-filling comments) and for various runtime paths.\r\n\r\nIf you wish, you can override these settings by specifying some or all of a\r\n`g:diffscuss_config` dictionary in your `.vimrc`:\r\n\r\n```vim\r\nlet g:diffscuss_config = {\r\n    \\'author': 'Your Name',\r\n    \\'email': 'your.email@example.com',\r\n    \\'diffscuss_dir': '/path/to/diffscuss',\r\n    \\'python': '/path/to/python'\r\n    \\}\r\n```\r\n\r\n### Inserting Comments\r\n\r\n* `<leader>dd`: insert a new comment contextually (Emacs `C-c C-c`)\r\n* `<leader>df`: insert a new review-level comment (Emacs `C-c C-f`)\r\n* `<leader>dr`: insert a new reply (Emacs `C-c C-r`)\r\n* `<leader>di`: insert a new comment (Emacs `C-c C-i`)\r\n\r\n### Showing the Source\r\n\r\n* `<leader>do`: show the old source version (Emacs `C-c -`)\r\n* `<leader>dn`: show the new source version (Emacs `C-c +`)\r\n* `<leader>ds`: show the local source version (Emacs `C-c s`)\r\n\r\n### Navigation\r\n\r\n* `]d`: jump to the start of the next comment\r\n* `[d`: jump to the start of the previous comment\r\n* `]D`: jump to the end of the next comment\r\n* `[D`: jump to the end of the previous comment\r\n* `]t`: jump to the start of the next thread\r\n* `[t`: jump to the start of the previous thread\r\n* `]T`: jump to the end of the next thread\r\n* `[T`: jump to the end of the previous thread\r\n\r\n## Pull Request Export (Experimental)\r\n\r\nDiffscuss ships with an experimental ```diffscuss github-import```\r\ncommand, which imports or more Github pull requests into local\r\nDiffscuss files.\r\n\r\nOne possible use for this (besides transition, if you're going to use\r\nDiffscuss), is to provide a searchable, offline copy of your pull\r\nrequests.\r\n\r\nThere's some talk about making this bidirectional, so that, e.g., you\r\ncould import a pull request, make local responses in diffscuss, and\r\npush the changes, but for the moment it's just talk.  Let us know if\r\nyou'd be interested in this (or interested in helping write it!).\r\n\r\n## What Else the Future Might Hold\r\n\r\n* Side-by-side diff viewing in the modes\r\n\r\n* Svn support\r\n\r\n* Support for Sublime\r\n\r\n* Support for Eclipse\r\n\r\n* Support for other editors\r\n\r\n* Export from ReviewBoard / other code review systems\r\n\r\n* Imports into various code review systems (Diffscuss as code review interchange)\r\n\r\nIf any of these appeal to you / scratch a personal itch, please let us\r\nknow--or even better, contribute!\r\n\r\n## Format Definition in Hairy Detail\r\n\r\n### Beginning of Line Marker\r\n\r\nAll Diffscuss lines begin with one '%'.\r\n\r\nThere's no limit to the length of a Diffscuss line, but keeping them\r\n80 chars or less when possible is probably good citizenship, since\r\nthey're meant to be read and edited inside editors.\r\n\r\n### Diffscuss Comment Format\r\n\r\nA Diffscuss comment begins with an author line, and possibly other\r\nheader lines, followed by at least one body line.\r\n\r\n### Header Lines\r\n\r\nA header line one '%' followed by at least one '*', followed by a\r\nspace, followed by a header of the format 'field-name: value'.\r\n\r\nHeader lines may also be empty, containing no 'field-name: value', in\r\nwhich case the space after the * is also optional.\r\n\r\nA header line must always begin a comment or follow another header\r\nline.\r\n\r\nFor example, all three of these are valid header lines:\r\n\r\n```\r\n%* author: Bob Jones\r\n```\r\n\r\n```\r\n%**\r\n```\r\n\r\n```\r\n%*** x-github-version: 1\r\n```\r\n\r\nThe field name cannot contain whitespace.  The value cannot contain a\r\nnewline.\r\n\r\nThe current Diffscuss headers are:\r\n\r\n* author\r\n\r\n* email\r\n\r\n* date\r\n\r\nNon-standard headers should begin with an 'x-', to keep compatible\r\nwith future additions to the Diffscuss format (for example, this is\r\nwhat the github import uses).\r\n\r\n#### The author Header\r\n\r\nAn author line is a standard header line with a field of 'author' and\r\na value indicating who authored the comment.  For example:\r\n\r\n```\r\n%* author: ejorgensen\r\n```\r\n\r\nOr\r\n\r\n```\r\n%** author: bsmith\r\n```\r\n\r\nEvery comment must begin with an author line.  All other headers are\r\noptional.\r\n\r\n#### The date Header\r\n\r\nDates should be specified in the full ISO 8601 standard, including\r\ntime zone offset, e.g. 2013-11-22T23:11:21-0400.\r\n\r\n### Body Lines\r\n\r\nA body line is one '%' character followed by at least one -, followed\r\nby a space, followed by arbitrary text.\r\n\r\nException: for an empty body line, the space is optional.\r\n\r\nFor example:\r\n\r\n```\r\n%- This is a body line.\r\n```\r\n\r\n```\r\n%-- And so is *this*.\r\n```\r\n\r\n```\r\n%- and this next body line\r\n%-\r\n%- is empty, so doesn't need a space, but could have one.\r\n```\r\n\r\nA body line must always follow a header line or another body line.\r\n\r\n### Threads\r\n\r\nA thread is one or more adjacent comments, properly threaded.\r\n\r\nFor example, this is a thread:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a one comment thread.\r\n```\r\n\r\nAnd so is this:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a two comment thread.\r\n%* author: bsmith\r\n%- With no replies, just two top level comments.\r\n```\r\n\r\nAnd so is this:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a two comment thread.\r\n%** author: bsmith\r\n%-- With a reply.\r\n```\r\n\r\nTo be explicit: the nesting / reply level of a thread is determined by\r\nthe number of '*' characters in each header line / '-' characters in\r\neach body line, which should remain constant for a given comment.\r\n\r\nA comment that is a reply to a previous comment should have one more\r\n'*' at the beginning of each header line and one more '-' at the\r\nbeginning of each body line than its parent comment.\r\n\r\nThe parent comment for any reply can always be determined by finding\r\nthe closest previous comment with one less level of nesting.  For\r\nexample:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a top-level comment.\r\n%** author: bsmith\r\n%-- And I'm a reply.\r\n%*** author: sjones\r\n%--- And I'm a reply to the reply.\r\n%** author: jkidd\r\n%-- And I'm a second reply to the original top-level comment.\r\n%* author: mdarks\r\n%- And I'm another top-level comment.\r\n%** author: lbutterman\r\n%-- And I'm a reply to the second top-level comment.\r\n```\r\n#### Position / Target of Threads\r\n\r\nDiffscuss threads are generally taken to apply to the line immediately\r\nabove them, so for example in this snippet:\r\n\r\n```\r\n+It's only just a test\r\n%* author: ejorgensen\r\n%- I have grave doubts about this change.  To me it appears foolhardy\r\n%- and dangerous.\r\n```\r\n\r\nThe comment applies to the line\r\n\r\n```\r\n+It's only just a test\r\n```\r\n\r\nA Diffscuss thread can also appear directly after the range\r\ninformation in a hunk, in which case the target of the comment is\r\nassumed to be the entire hunk, for example:\r\n\r\n```\r\n--- 1.txt\t2013-03-07 20:18:10.000000000 -0500\r\n+++ 2.txt\t2013-03-07 20:18:35.000000000 -0500\r\n@@ -1,5 +1,7 @@\r\n%* author: ejorgensen\r\n%- I love this hunk.\r\n This is a test.\r\n\r\n-It's just a test\r\n+It's only just a test\r\n```\r\n\r\nFinally, if a thread appears at the very top of the Diffscuss file,\r\nthe thread applies to the whole changeset (where it should generally\r\nact as a thread discussing the review as a whole--for example,\r\nintroductory remarks about what the changes are attempting to achieve,\r\n\"ship it\" remarks, etc.).\r\n\r\nEvery Diffscuss file must begin with such a changeset level thread\r\n(optionally preceded by any number of \"magic\" comment lines, e.g. \"#\r\n-*- coding: utf-8 -*-\").\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}