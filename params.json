{"name":"Diffscuss","tagline":"Code reviews.  In plain text.","body":"# Diffscuss: Code Reviews.  In Plain Text.\r\n\r\n## What is Diffscuss?\r\n\r\n* A format for embedding code reviews into unified diff files.\r\n\r\n* An Emacs mode for creating / reading / responding to reviews in that\r\n  format, with git integration.\r\n\r\n* gen-diffscuss.py, a tool for generating code reviews from git repos.\r\n\r\nThere are also plans for: a Vim mode, some command line tools, and\r\ntools to allow diffscuss files to serve as a code-review interchange\r\nformat.\r\n\r\n## Why Use Diffscuss?\r\n\r\nIf you like:\r\n\r\n* Plain text formats that play nicely with the *nix toolchain\r\n\r\n* Lightweight, flexible code-review processes\r\n\r\n* The idea of being able to work with / keep your reviews close to\r\n  your source, even in the same repository\r\n\r\nThen you might want to give Diffscuss a look.\r\n\r\n## The Format in a Nutshell\r\n\r\nDiffscuss adds a single beginning-of-line character to the unified\r\ndiff format: %, which marks the beginning of a comment line.  Lines\r\nbeginning with %* are comment headers, and lines beginning with %- are\r\ncomment bodies.  The number of * or - characters indicates reply\r\nthreading.\r\n\r\nSince one example is worth a lot of explaining, here's an example\r\ndiffscuss file:\r\n\r\n```\r\n%*\r\n%* author: Bob Jones\r\n%* email: bjones@example.com\r\n%* date: 2013-03-15T19:00:21-0400\r\n%*\r\n%- This change set accomplishes two purposes:\r\n%-\r\n%- * Add a version of the world greeting for our Spanish-speaking users.\r\n%-\r\n%- * Indicate that it's only a test.\r\n%-\r\n%**\r\n%** author: Edmund Jorgensen\r\n%** email: edmund@example.com\r\n%** date: 2013-03-16T19:00:45-0400\r\n%**\r\n%-- Looks good, one question about internationalization.\r\n%--\r\ndiff --git a/example.txt b/example.txt\r\nindex f75ba05..01632d8 100644\r\n--- a/example.txt\r\n+++ b/example.txt\r\n@@ -1 +1,7 @@\r\n Hello, world.\r\n+\r\n+Hola, mundo.\r\n%*\r\n%* author: Edmund Jorgensen\r\n%* email: edmund@example.com\r\n%* date: 2013-03-16T19:00:37-0400\r\n%*\r\n%- I'm not sure we want to go international just yet.\r\n%-\r\n%**\r\n%** author: Bob Jones\r\n%** email: bjones@example.com\r\n%** date: 2013-03-17T18:12:49-0400\r\n%**\r\n%-- What are your specific concerns?\r\n%--\r\n+\r\n+This is a test.\r\n+\r\n+It is only a test.\r\n```\r\n\r\nThe comments at the top of the file apply to the entire review in\r\ngeneral.\r\n\r\nThe other two comments address the ```+Hola, mundo.``` line (that is,\r\nthe line directly above the first comment in the thread).\r\n\r\nTake a look at the \"Format Definition\" section for much more detail.\r\n\r\n## The Emacs Mode\r\n\r\nThe Emacs mode colorizes diffscuss files to make for easier reading.\r\nIn addition it helps with:\r\n\r\n### Inserting Comments\r\n\r\nThe main command you need to know is ```C-c C-c```, which generally\r\n\"does the right thing\" based on the position of the cursor.  To wit:\r\n\r\n* If the cursor is at the very top of the buffer, it will insert a new\r\n  review-level comment (this function is available anywhere in the\r\n  buffer with ```C-c C-f```).\r\n\r\n* If the cursor is inside another comment, it will create a reply to\r\n  that comment (this can also be invoked with ```C-c C-r```).\r\n\r\n* If the cursor is inside the diff index information for a file /\r\n  hunk, it will insert a comment after the \"range line\" (the line\r\n  beginning with @@).\r\n\r\n* If the cursor is on a diff line, it will create a comment directly\r\n  below that line (this is also available with ```C-c C-i```).\r\n\r\n### Showing the Source\r\n\r\nIf you position the cursor on one of the diff lines in a Diffscuss\r\nfile, then:\r\n\r\n* ```C-c -``` will open up a temporary buffer containing the old\r\n  version of the source (if it's available locally), with the cursor\r\n  positioned on the same line.\r\n\r\n* ```C-c +``` will open up a temporary buffer containing the new\r\n  version of the source (if it's available locally), with the cursor\r\n  positioned on the same line.\r\n\r\nBoth of these require that the Diffscuss file you're visiting is\r\nlocated inside the git repo directory.\r\n\r\n* ```C-c s``` will attempt to find the local source file / line in\r\n  that file that's the best candidate to match up with the diffscuss\r\n  line the cursor is currently on.\r\n\r\nThis requires that the diffscuss file you are visiting is somewhere\r\nunder a git checkout of the repo against which the diffscuss file was\r\ngenerated, and that you have set the ```diffscuss-dir``` Emacs\r\nvariable to root directory of your diffscuss installation (where\r\nfind-local-source.py is located).\r\n\r\n## gen-diffscuss.py\r\n\r\ngen-diffscuss.py is a helper script for creating a new Diffscuss file\r\nwith diffs and log messages from a set of changes in git.\r\n\r\nFor example,\r\n\r\n```gen-diffscuss.py HEAD~3..HEAD > some_code_review.diffscuss```\r\n\r\nMakes a Diffscuss file containing the diffs from the last three\r\ncommits in a local git repo, introduced with a comment at the top\r\ncontaining all the log messages for those three commits.\r\n\r\n## Format Definition\r\n\r\n### Beginning of Line Marker\r\n\r\nAll Diffscuss lines begin with one '%'.\r\n\r\nThere's no limit to the length of a Diffscuss line, but keeping them\r\n80 chars or less when possible is probably good citizenship, since\r\nthey're meant to be read and edited inside editors.\r\n\r\n### Diffscuss Comment Format\r\n\r\nA Diffscuss comment begins with an author line, and possibly other\r\nheader lines, followed by at least one body line.\r\n\r\n### Header Lines\r\n\r\nA header line one '%' followed by at least one '*', followed by a\r\nspace, followed by a header of the format 'field-name: value'.\r\n\r\nHeader lines may also be empty, containing no 'field-name: value', in\r\nwhich case the space after the * is also optional.\r\n\r\nA header line must always begin a comment or follow another header\r\nline.\r\n\r\nFor example, all three of these are valid header lines:\r\n\r\n```\r\n%* author: Bob Jones\r\n```\r\n\r\n```\r\n%**\r\n```\r\n\r\n```\r\n%*** x-github-version: 1\r\n```\r\n\r\nThe field name cannot contain whitespace.  The value cannot contain a\r\nnewline.\r\n\r\nThe current Diffscuss headers are:\r\n\r\n* author\r\n\r\n* email\r\n\r\n* date\r\n\r\nNon-standard headers should begin with an 'x-', to keep compatible\r\nwith future additions to the Diffscuss format.\r\n\r\n#### The author Header\r\n\r\nAn author line is a standard header line with a field of 'author' and\r\na value indicating who authored the comment.  For example:\r\n\r\n```\r\n%* author: ejorgensen\r\n```\r\n\r\nOr\r\n\r\n```\r\n%** author: bsmith\r\n```\r\n\r\nEvery comment must begin with an author line.  All other headers are\r\noptional.\r\n\r\n#### The date Header\r\n\r\nDates should be specified in the full ISO 8601 standard, including\r\ntime zone offset, e.g. 2013-11-22T23:11:21-0400.\r\n\r\n### Body Lines\r\n\r\nA body line is one '%' character followed by at least one -, followed\r\nby a space, followed by arbitrary text.\r\n\r\nException: for an empty body line, the space is optional.\r\n\r\nFor example:\r\n\r\n```\r\n%- This is a body line.\r\n```\r\n\r\n```\r\n%-- And so is *this*.\r\n```\r\n\r\n```\r\n%- and this next body line\r\n%-\r\n%- is empty, so doesn't need a space, but could have one.\r\n```\r\n\r\nA body line must always follow a header line or another body line.\r\n\r\n### Threads\r\n\r\nA thread is one or more adjacent comments, properly threaded.\r\n\r\nFor example, this is a thread:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a one comment thread.\r\n```\r\n\r\nAnd so is this:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a two comment thread.\r\n%* author: bsmith\r\n%- With no replies, just two top level comments.\r\n```\r\n\r\nAnd so is this:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a two comment thread.\r\n%** author: bsmith\r\n%-- With a reply.\r\n```\r\n\r\nTo be explicit: the nesting / reply level of a thread is determined by\r\nthe number of '*' characters in each header line / '-' characters in\r\neach body line, which should remain constant for a given comment.\r\n\r\nA comment that is a reply to a previous comment should have one more\r\n'*' at the beginning of each header line and one more '-' at the\r\nbeginning of each body line than its parent comment.\r\n\r\nThe parent comment for any reply can always be determined by finding\r\nthe closest previous comment with one less level of nesting.  For\r\nexample:\r\n\r\n```\r\n%* author: ejorgensen\r\n%- I'm a top-level comment.\r\n%** author: bsmith\r\n%-- And I'm a reply.\r\n%*** author: sjones\r\n%--- And I'm a reply to the reply.\r\n%** author: jkidd\r\n%-- And I'm a second reply to the original top-level comment.\r\n%* author: mdarks\r\n%- And I'm another top-level comment.\r\n%** author: lbutterman\r\n%-- And I'm a reply to the second top-level comment.\r\n```\r\n#### Position / Target of Threads\r\n\r\nDiffscuss threads are generally taken to apply to the line immediately\r\nabove them, so for example in this snippet:\r\n\r\n```\r\n+It's only just a test\r\n%* author: ejorgensen\r\n%- I have grave doubts about this change.  To me it appears foolhardy\r\n%- and dangerous.\r\n```\r\n\r\nThe comment applies to the line\r\n\r\n```\r\n+It's only just a test\r\n```\r\n\r\nA Diffscuss thread can also appear directly after the range\r\ninformation in a hunk, in which case the target of the comment is\r\nassumed to be the entire hunk, for example:\r\n\r\n```\r\n--- 1.txt\t2013-03-07 20:18:10.000000000 -0500\r\n+++ 2.txt\t2013-03-07 20:18:35.000000000 -0500\r\n@@ -1,5 +1,7 @@\r\n%* author: ejorgensen\r\n%- I love this hunk.\r\n This is a test.\r\n\r\n-It's just a test\r\n+It's only just a test\r\n```\r\n\r\nFinally, if a thread appears at the very top of the Diffscuss file,\r\nthe thread applies to the whole changeset (where it should generally\r\nact as a thread discussing the review as a whole--for example,\r\nintroductory remarks about what the changes are attempting to achieve,\r\n\"ship it\" remarks, etc.).\r\n\r\n## What the Future Might Hold\r\n\r\n### Providing for the Liberation of Code Reviews (Aspirational)\r\n\r\nRight now, if you use Github (for example), you can stop using Github\r\nat any moment without losing any of your code and history--it's all in\r\nyour git repo.\r\n\r\nGithub has done a fantastic job of making sure you can even take your\r\nwiki information with you--that's just another git repo.\r\n\r\nBut the comments on your pull requests--all that amazing and rich\r\nhistory of problems being hammered out and nits picked--is harder to\r\nreconstruct.  Github has--in amazing non-lockin-y fashion, and mad\r\nprops to them for it--provided an API to get all the information about\r\nyour pull requests, but it's non-trivial to reconstruct it all,\r\nrequiring a bunch of calls and a bunch of reconstructed json.\r\n\r\nNow imagine you could hit the pull request url with a .diffscuss\r\nextension (as you can already do with a .diff extension) and pull in\r\nthe diff--**with** the contextualized comments, right inline, for\r\nviewing in your editor or whatever.  That would be pretty cool, no?\r\nEspecially if you could then import into another code review system\r\nwith relatively little effort.\r\n\r\nOr say that, just like you can with your Github wiki, you could clone\r\na git repo of all your project's pull requests, in a simple textual\r\nformat, for offline reading, and potentially--with some push\r\nmagic--even offline code reviews.\r\n\r\nThis is an aspirational in the extreme goal--after all, Github would\r\nhave to create the .diffscuss endpoint etc.--but a simple, standard\r\nformat helps pave the way.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}